(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{1124:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(4),c=r(2),o=r(784),s=r(793),i=r(5),u=(r(871),r(253)),l=r(251),m=r(36),b=r(86),p=r(16),f=r(8),d=r(56);function O(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var j=function(e){var t=e.campaign,r=e.pauseUnpauseBroadcast,o=t&&t.type?parseInt(t.type):1,s=Object(i.o)();return Object(n.createElement)(a.Card,{className:"bwf-crm-campaign-stats-overview"},Object(n.createElement)(a.CardHeader,{className:"bwf-crm-overview-report-header"},Object(n.createElement)("span",{className:"bwf-form-title"},Object(c.__)("Overview","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-display-flex"},Object(n.createElement)("span",{className:"bwf-broadcast-status"},Object(n.createElement)("span",{className:"bwf-broadcast-s-"+t.status},t.status&&s.hasOwnProperty(t.status)?s[t.status].label:t.status)),[2,3,6].includes(parseInt(t.status))&&Object(n.createElement)(d.a,{label:Object(c.__)("Quick Actions","wp-marketing-automations"),menuPosition:"bottom right",renderContent:function(e){var a=e.onToggle,o={3:Object(c.__)("Pause","wp-marketing-automations"),6:Object(c.__)("Resume","wp-marketing-automations"),2:Object(c.__)("Unschedule","wp-marketing-automations")},s={2:1,3:6,6:3};return Object(n.createElement)(b.a,{isClickable:!0,onInvoke:function(){r(t.id,s[parseInt(t.status)]),a()}},Object(n.createElement)(p.a,{justify:"flex-start"},Object(n.createElement)(p.c,null,Object(n.createElement)(f.a,{icon:6===parseInt(t.status)?"play":"pause",color:"#000"})),Object(n.createElement)(p.c,null,o[parseInt(t.status)])))}}))),Object(n.createElement)(a.CardBody,{className:"bwf-crm-campaign-stats-overview-card bwf-crm-hide-delta"},Object(n.createElement)(u.a,{key:1},(function(){return[Object(n.createElement)(l.a,{isHomescreen:!0,key:4,value:Number.isInteger(parseInt(t.count))?parseInt(t.count):0,label:Object(c.__)("Contacts","wp-marketing-automations")}),Object(n.createElement)(l.a,{isHomescreen:!0,key:1,value:Number.isInteger(parseInt(t.sent))?parseInt(t.sent):0,label:Object(c.__)("Sent","wp-marketing-automations")})].concat(O(1===o?[Object(n.createElement)(l.a,{isHomescreen:!0,key:2,value:(Number.isInteger(parseFloat(t.open_count))?parseFloat(t.open_rate):0)+" %",label:Object(c.__)("Open Rate","wp-marketing-automations")})]:[]),[Object(n.createElement)(l.a,{isHomescreen:!0,key:3,value:(Number.isInteger(parseFloat(t.click_count))?parseFloat(t.click_rate):0)+" %",label:Object(c.__)("Click Rate","wp-marketing-automations")}),Object(n.createElement)(l.a,{isHomescreen:!0,key:5,value:Number.isInteger(parseInt(t.unsubs))?parseInt(t.unsubs):0,label:Object(c.__)("Unsubscribe","wp-marketing-automations")})])}))),Object(n.createElement)(a.CardFooter,null,Object(n.createElement)(m.a,{href:"admin.php?page=autonami&path=/broadcast/"+t.id+"/analytics",type:"bwf-crm",className:"bwf-a-no-underline"},Object(c.__)("View Details","wp-marketing-automations"))))},v=r(812),h=r(63),g=r(256),y=r(12),E=r.n(y),_=r(128),k=r(3),S=r(820),I=r(809),N=r(127),R=r(7),C=r(792),A=r(15);function x(e,t,r,n,a,c,o){try{var s=e[c](o),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,a)}function P(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function o(e){x(c,n,a,o,s,"next",e)}function s(e){x(c,n,a,o,s,"throw",e)}o(void 0)}))}}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,c=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,c=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw c}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var U=function(){var e=M(Object(n.useState)(!1),2),t=e[0],r=e[1],u=o.a.getCampaignData(),l=Object(s.a)().resetCampaign,m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;setTimeout((function(){e&&(l(e),Object(A.k)({path:"/broadcast/"+e.id,page:"autonami"},"/",{})),r(!1)}),2e3)},b=Object(C.a)(function(){var e=P(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E()({path:Object(i.k)("/broadcast/"),method:"POST",data:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{onSuccess:function(e){return m(e.result)},onError:function(){return m()}}),p=Object(R.useCallback)(P(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(!0),t={title:Object(c.__)("Send to Unopen","wp-marketing-automations"),description:"",type:u.type,created_by:Object(i.u)(),createUnopen:u.id},b.mutate(t);case 3:case"end":return e.stop()}}),e)}))),[u]);return Object(n.useEffect)((function(){b.isSuccess&&(r(!1),b.reset())}),[b.isSuccess]),Object(n.createElement)(n.Fragment,null,Object(n.createElement)(_.a,{onRequestClose:function(){r(!1),b.reset()},content:Object(c.__)("We are creating Unopen Broadcast"),isLoading:b.isLoading,errorMessage:b.isError&&(b.error&&b.error.message?b.error.message:Object(c.__)("Unable to create unopen broadcast","wp-marketing-automations")),isOpen:t}),Object(n.createElement)(a.Button,{isSecondary:!0,onClick:p},Object(c.__)("Send to Unopen","wp-marketing-automations")))},B=function(){var e=o.a.getCampaignData();return 4===parseInt(e.status)&&1===parseInt(e.type)&&!e.is_unopen_grandchild&&Object(n.createElement)(a.Card,{className:"bwf-crm-overview-detail-wrap bwf-card-display-block"},Object(n.createElement)(a.CardHeader,{className:"bwf-crm-overview-report-header"},Object(c.__)("Actions","wp-marketing-automations")),Object(n.createElement)(a.CardBody,null,Object(n.createElement)("div",{className:"bwf-report-row",key:1},Object(n.createElement)("div",{className:"bwf-report-row-label bwf-report-row-full"},Object(c.__)("Send to contacts who haven't opened the emails yet.","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)("div",null,Object(n.createElement)(U,null)))))},H=r(872);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q(e,t,r,n,a,c,o){try{var s=e[c](o),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,a)}function V(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function o(e){q(c,n,a,o,s,"next",e)}function s(e){q(c,n,a,o,s,"throw",e)}o(void 0)}))}}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,c=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,c=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw c}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return J(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}t.default=function(e){var t=e.campaignType,r=Object(n.useContext)(i.d),u=o.a.getCampaignData(),l=Object(i.q)(),m=Object(s.a)(),b=m.setCampaignValues,p=m.setEditableMode,f=$(Object(n.useState)(!1),2),d=f[0],O=f[1],w=$(Object(n.useState)({loading:!1,status:!1}),2),y=w[0],R=w[1];Object(v.a)("overview","",!0,!0,!1,t);var C=$(Object(n.useState)(!0),2),A=C[0],x=C[1],P=Object(N.a)().setL2Title;Object(n.useEffect)((function(){P(Object(n.createElement)(n.Fragment,null,u.title,!!u&&Object(n.createElement)(H.a,{broadcast:u})))}),[u]);var M=function(){var e=V(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x(!1),e.next=4,E()({path:Object(i.k)("/broadcast/".concat(u.id,"/overview-stats")),method:"GET"}).then((function(e){if(200===e.code){if(e.hasOwnProperty("result"))b("data",D(D({},u),e.result));x(!0)}}));case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),x(!0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}();Object(I.a)((function(){3===parseInt(u.status)&&A&&M()}),5e3);var T,U,L,F=function(){var e=V(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E()({path:Object(i.k)("/broadcast/".concat(t,"/pause-unpause")),method:"POST",data:{status:parseInt(n)},headers:{"X-HTTP-Method-Override":"POST"}}).then((function(e){if(200!=e.code)throw Error(Object(i.i)(null==e?void 0:e.message));r(e.message);var t=u;t.status=n,b("data",t),Object(i.Z)(r,2e3)})).catch((function(e){throw Error(Object(i.i)(null==e?void 0:e.message))}));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),R({status:!0,error:e.t0.message});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,r){return e.apply(this,arguments)}}();return Object(n.createElement)(n.Fragment,null,Object(n.createElement)(h.a,null),u&&Object(n.createElement)(n.Fragment,null,Object(n.createElement)("div",{className:"bwfcrm-overview-wrap"},5===parseInt(u.status)&&Object(n.createElement)(a.Notice,{className:"bwf-error-notice",status:"warning",isDismissible:!1},Object(n.createElement)("b",null,Object(c.__)("Halt Reason: ","wp-marketing-automations")),u.data&&u.data.halt_reason?u.data.halt_reason:Object(c.__)("Unknwon error occurred","wp-marketing-automations")),Object(n.createElement)(j,{campaign:u,pauseUnpauseBroadcast:F}),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)(a.Card,{className:"bwf-crm-overview-detail-wrap"},Object(n.createElement)(a.CardHeader,{className:"bwf-crm-overview-report-header"},Object(n.createElement)("span",{className:"bwf-form-title"},Object(c.__)("Details","wp-marketing-automations"))),Object(n.createElement)(a.CardBody,null,Object(n.createElement)("div",{className:"bwf-report-row"},Object(n.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Title","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-report-row-value"},u.title)),Object(n.createElement)("div",{className:"bwf-report-row"},Object(n.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Type","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-report-row-value"},l[u.type].label)),Object(n.createElement)("div",{className:"bwf-report-row"},Object(n.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Sent on","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-report-row-value"},u.execution_time?Object(i.K)(u.execution_time,!1,!0):" - ")),u.description&&Object(n.createElement)("div",{className:"bwf-report-row"},Object(n.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Description","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-report-row-value"},u.description)),u.data.hasOwnProperty("filters")&&!Object(k.isEmpty)(u.data.filters)&&Object(n.createElement)("div",{className:"bwf-report-row"},Object(n.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Segments","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-report-row-value"},Object(S.b)(u.data.filters))),u.data&&u.data.content&&u.data.content.map((function(e,t){return Object(n.createElement)("div",{className:"bwf-report-row",key:"bwf-report-row-".concat(t)},Object(n.createElement)("div",{className:"bwf-report-row-label"},u.data.content.length>1?Object(c.__)("Content #","wp-marketing-automations")+(parseInt(t)+1):Object(c.__)("Content","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-report-row-value bwf-report-value-modal"},1===parseInt(u.type)&&e.subject&&Object(n.createElement)("span",null,e.subject),Object(n.createElement)(a.Button,{isSecondary:!0,className:"bwf-a-no-underline",onClick:function(){O(!0),R(e)}},Object(c.__)("View details","wp-marketing-automations"))))})),parseInt(u.status)<3&&Object(n.createElement)("div",{className:"bwf-report-row"},Object(n.createElement)("div",{className:"bwf-report-row-label"}),Object(n.createElement)("div",{className:"bwf-report-row-value bwf-report-value-modal"},Object(n.createElement)(a.Button,{isSecondary:!0,className:"bwf-a-no-underline",onClick:function(){return p(!0)}},Object(c.__)("Edit Broadcast","wp-marketing-automations")))),(T=y,U="",L=!0,3==t&&T.hasOwnProperty("whatsAppImage")&&T.whatsAppImage&&T.hasOwnProperty("whatsAppImageSetting")&&T.whatsAppImageSetting.hasOwnProperty("position")&&!Object(k.isEmpty)(T.whatsAppImageSetting.position)&&T.whatsAppImageSetting.hasOwnProperty("imageURL")&&!Object(k.isEmpty)(T.whatsAppImageSetting.imageURL)&&(U="before"===T.whatsAppImageSetting.position?Object(n.createElement)(n.Fragment,null,Object(n.createElement)("img",{src:T.whatsAppImageSetting.imageURL,width:50,height:50}),Object(n.createElement)("div",{dangerouslySetInnerHTML:{__html:T.body}})):Object(n.createElement)(n.Fragment,null,Object(n.createElement)("div",{dangerouslySetInnerHTML:{__html:T.body}}),Object(n.createElement)("img",{src:T.whatsAppImageSetting.imageURL,width:50,height:50})),L=!1),L&&(U=Object(n.createElement)("div",{dangerouslySetInnerHTML:{__html:"editor"===T.type?T.editor.body:T.body}})),Object(n.createElement)(g.a,{isOpen:d,isLoading:!1,onRequestClose:function(){return O(!1)},subject:1===parseInt(u.type)&&T.subject,preHeader:1===parseInt(u.type)&&T.preheader,body:U,type:T.type,sourceType:2,mode:u.type,utm:T.utm})),Object(n.createElement)(_.a,{modalTitle:"Broadcast Action",confirmText:y.confirmText,confirmButtonText:y.buttonConfirm,cancelButtonText:y.buttonCancel,onConfirm:y.onConfirm,isLoading:y.loading,successMessage:y.success,errorMessage:y.error,onRequestClose:function(){return R({status:!1})},isOpen:y.status}))),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)(B,null))))}},792:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var n=r(11),a=r(7),c=r.n(a),o=r(25),s=r(13),i=r(26),u=r(245),l=function(e){function t(t,r){var n;return(n=e.call(this)||this).client=t,n.setOptions(r),n.bindMethods(),n.updateResult(),n}Object(i.a)(t,e);var r=t.prototype;return r.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},r.setOptions=function(e){this.options=this.client.defaultMutationOptions(e)},r.onUnsubscribe=function(){var e;this.listeners.length||(null==(e=this.currentMutation)||e.removeObserver(this))},r.onMutationUpdate=function(e){this.updateResult();var t={listeners:!0};"success"===e.type?t.onSuccess=!0:"error"===e.type&&(t.onError=!0),this.notify(t)},r.getCurrentResult=function(){return this.currentResult},r.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},r.mutate=function(e,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,Object(n.a)({},this.options,{variables:void 0!==e?e:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},r.updateResult=function(){var e=this.currentMutation?this.currentMutation.state:Object(u.b)();this.currentResult=Object(n.a)({},e,{isLoading:"loading"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset})},r.notify=function(e){var t=this;o.a.batch((function(){t.mutateOptions&&(e.onSuccess?(null==t.mutateOptions.onSuccess||t.mutateOptions.onSuccess(t.currentResult.data,t.currentResult.variables,t.currentResult.context),null==t.mutateOptions.onSettled||t.mutateOptions.onSettled(t.currentResult.data,null,t.currentResult.variables,t.currentResult.context)):e.onError&&(null==t.mutateOptions.onError||t.mutateOptions.onError(t.currentResult.error,t.currentResult.variables,t.currentResult.context),null==t.mutateOptions.onSettled||t.mutateOptions.onSettled(void 0,t.currentResult.error,t.currentResult.variables,t.currentResult.context))),e.listeners&&t.listeners.forEach((function(e){e(t.currentResult)}))}))},t}(r(52).a),m=r(242);function b(e,t,r){var a=c.a.useRef(!1),i=c.a.useState(0)[1],u=Object(s.k)(e,t,r),b=Object(m.b)(),p=c.a.useRef();p.current?p.current.setOptions(u):p.current=new l(b,u);var f=p.current.getCurrentResult();c.a.useEffect((function(){a.current=!0;var e=p.current.subscribe(o.a.batchCalls((function(){a.current&&i((function(e){return e+1}))})));return function(){a.current=!1,e()}}),[]);var d=c.a.useCallback((function(e,t){p.current.mutate(e,t).catch(s.i)}),[]);if(f.error&&p.current.options.useErrorBoundary)throw f.error;return Object(n.a)({},f,{mutate:d,mutateAsync:f.mutate})}},809:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);var a=function(e,t){var r=Object(n.useRef)();Object(n.useEffect)((function(){r.current=e}),[e]),Object(n.useEffect)((function(){if(null!==t){var e=setInterval((function(){r.current()}),t);return function(){return clearInterval(e)}}}),[t])}}}]);