!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=146)}({146:function(e,t,i){e.exports=i(147)},147:function(e,t){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}jQuery((function(e){var t="before",r="US $";(function(){Handlebars.registerHelper("format_price",(function(e,i){e=parseFloat(e);var n=i.hash.decimalLength||2,a=i.hash.thousandsSep||",",o=i.hash.decimalSep||".",s="\\d(?=(\\d{3})+"+(n>0?"\\D":"$")+")",c=e.toFixed(Math.max(0,~~n)),d=(o?c.replace(".",o):c).replace(new RegExp(s,"g"),"$&"+a);return"before"===t?r+""+d:d+""+r})),Handlebars.registerHelper("stars",(function(e){for(var t="",i=e.toString().split("."),r=!1,n=1;n<=5;n++)i[0]>=n?t+='<i class="fa fa-star"></i>':r?t+='<i class="fa fa-star-o"></i>':(r=!0,i[1]>7?t+='<i class="fa fa-star"></i>':i[1]<3?t+='<i class="fa fa-star-o"></i>':i[1]>=3&&i[1]<=7?t+='<i class="fa fa-star-half-o"></i>':t+='<i class="fa fa-star-o"></i>');return t}))})();var n=!1;(function(){var t=null;function r(t,r,n){r=""!==r&&"object"===i(r)?window.ADS.serialize(r):r,e.ajaxQueue({url:ajaxurl,data:{action:"adsw_action_reviews",ads_action:t,args:r},type:"POST",dataType:"json",success:n})}function a(){if(e("#ads_review-form .js-select-cat").hide(),"categories"==e('#ads_review-form [name="prod_type"]').val()){var t=[];e("option:selected","#ads_review-form .js-select-cat").each((function(){t.push(e(this).val())})),e('#ads_review-form [name="applyto"]').val(t.join()),e("#ads_review-form .js-select-cat").show()}e("#apply_min").toggle(e("#apply_empty").is(":checked")),parseInt(e("#apply_min").val())<1&&e("#apply_min").val(1)}function o(t){var i=e("#ali-review").html(),r=e("#ads_review-form");if(t)if(t.hasOwnProperty("error"))window.ADS.notify(t.error,"danger");else{r.html(window.ADS.objTotmpl(i,t)),setTimeout(window.ADS.switchery(r),300);var n=parseInt(e("#total_item").val()),o=parseInt(e("#current_item").val());o>0&&n>0&&window.ADS.progressText(e(".progress-head"),n,o);var s=e('#ads_review-form [name="applyto"]').val();s=s?s.split(","):[],e("#ads_review-form .js-select-cat").find('[multiple="multiple"]').multiselect("select",s),a(),e.event.trigger({type:"request:done",obj:"#ads_review-form"})}}function s(t,i){if(void 0===i)return!1;var r=function(t){var i=t.split("?"),r=i[0],n=i[1].split("&"),a={};return e.each(n,(function(e,t){var i=t.split("=");a[i[0]]=i[1]})),{hostName:r,urlArray:a}}(t);return e.each(i,(function(e,t){r.urlArray[e]=t})),function(t,i){var r=t+"?",n=[];return e.each(i,(function(e,t){void 0===t&&(t=""),n.push(e+"="+t)})),r+=n.join("&")}(r.hostName,r.urlArray)}function c(t){var i=t.post_id,r=e("#ads_activities-list").find('[data-post_id="'+i+'"]'),n=e("#ads_activities-list").find('[data-post_id="'+i+'"] .count-reviews'),a=(t.product_id,!0===t.isRu||"true"===t.isRu),o=parseInt(n.text())+t.count;n.text(o),o<t.count_review&&t.page<30?u(t.page,i,t.feedbackUrl,a):(r.find(".loader-action").hide(),r.find(".loader-done").show(),p(!1))}function d(t){var i=t.index.params,r=t.index.reviews||[],n=t.obj,a=i.post_id,o=i.product_id,s="true"===i.isRu||!0===i.isRu,d=i,l={flag:"",author:"",star:"",feedback:"",date:""},u=e("#ads_activities-list").find('[data-post_id="'+a+'"] .count-reviews').text();u=parseInt(u);var f=[];n&&n.find(".feedback-list-wrap .feedback-item").each((function(t,i){var n,a,o=[];(l={}).feedback=e(this).find(".buyer-feedback").text(),e(this).find(".buyer-feedback .r-time-new").length&&(l.feedback=e(this).find(".buyer-feedback span:not(.r-time-new)").text()),l.feedback=l.feedback.replace("seller","store"),l.flag=e(this).find(".css_flag").text(),l.author=e(this).find(".user-name").text(),l.star=(n=e(this).find(".star-view span").attr("style"),a=0,(n=parseInt(n.replace(/[^0-9]/g,"")))>0&&(a=parseInt(5*n/100)),a),e(this).find(".pic-view-item").each((function(t,i){o.push(e(i).data("src"))}));var s=e(this).find(".r-time");e(this).find(".r-time-new").length&&(s=e(this).find(".r-time-new")),l.date=s.text(),l.images=o,r.push(l)}));for(var w in r)f.push(r[w]);0!==r.length&&u<=d.countReviews?function(t,i,r){e.ajaxQueue({url:ajaxurl,data:{action:"adsw_action_reviews",ads_action:t,args:i},type:"POST",dataType:"json",success:r})}("upload_review",{post_id:a,product_id:o,isRu:s,feed_list:ADS.b64EncodeUnicode(JSON.stringify(f)),min_star:d.min_star,withPictures:d.withPictures,uploadImages:d.uploadImages,ignoreImages:d.ignoreImages,importedReview:u,page:d.page++,feedbackUrl:d.feedbackUrl,count_review:e("#count_review").val(),approved:d.approved,select_country:JSON.stringify(d.select_country),skip_keywords:d.skip_keywords,select_translate:d.select_translate},c):p(!1)}function l(t){var i=e(".progress-head");if(t.hasOwnProperty("error"))window.ADS.notify(t.error,"danger"),window.ADS.btnUnLock(n),n=!1;else if(t.hasOwnProperty("message"))window.ADS.notify(t.message,"success"),window.ADS.progressText(i,10,10),window.ADS.btnUnLock(n),n=!1;else{var r=e("#item-review-template").html(),a=e("#ads_activities-list");a.find(".table-products").length||a.html(e("<div/>",{class:"table-products"})),a=a.find(".table-products"),window.ADS.progressText(i,t.total,t.current);var o=a.find(".review-item");o.length>=15&&o.last().remove(),a.find(".loader-action").hide(),a.find(".loader-done").show(),a.prepend(window.ADS.objTotmpl(r,t.row)),a.find("div:first").find(".loader-action").show(),e("#current_item").val(t.current);var s=-1!==t.row.productUrl.indexOf("aliexpress.ru");s?u(1,t.row.post_id,!1,t.row.product_id,s):t.row.feedbackUrl?u(1,t.row.post_id,t.row.feedbackUrl,t.row.product_id,s):p()}}function u(i,r,n,a,o){e("#ads_activities-list").find('[data-post_id="'+r+'"]').find(".loader-action").show();var c=e("#select_translate").val(),l={rate:e("#min_star").val(),countReviews:e("#count_review").val(),translate:"none"===c?"+N+":"+Y+",ignoreImages:e("#ignoreImages").is(":checked"),withPictures:e("#withImage").is(":checked"),uploadImages:e("#uploadImage").is(":checked"),approved:e("#approved").is(":checked"),skip_keywords:e("#skip_keywords").val(),select_translate:c,select_country:e("#select_country").val()},u=n&&"false"!==n?s(n,{translate:l.translate,page:i,withPictures:l.withPictures}):"",p={post_id:r,product_id:a,isRu:o,page:i,feedbackUrl:n,countReviews:l.countReviews,withPictures:l.withPictures,uploadImages:l.uploadImages,ignoreImages:l.ignoreImages,min_star:l.rate,approved:l.approved,skip_keywords:l.skip_keywords,select_translate:l.select_translate,select_country:l.select_country};if(o){var f=[];window.ADS.aliExtension.sendAliExtension("getReviewProduct",{productid:a,page:i}).then((function(e){var t,i,r=e.reviewInfo.reviews;for(var n in r){var a=r[n];f.push({feedback:a.text,flag:a.country.toUpperCase(),author:a.username,star:a.rating,date:(t=a.date,void 0,i=void 0,{"янв":"01","фев":"02","мар":"03","апр":"04","май":"05","июн":"06","июл":"07","авг":"08","сен":"09","окт":"10","ноя":"11","дек":"12"},i=t.match(/(\d+) (\W+) (\d+) (\d+):(\d+)/im),{"янв":"01","фев":"02","мар":"03","апр":"04","май":"05","июн":"06","июл":"07","авг":"08","сен":"09","окт":"10","ноя":"11","дек":"12"}[i[2]]),images:a.gallery})}d({obj:null,index:{params:p,reviews:f}})}))}else setTimeout((function(){window.ADS.aliExtension.addTask(u,d,t,{params:p})}),2e3)}function p(t){var i=t?"first_review":"next_review";e("#product-list").show(),r(i,e("#ads_review-form"),l)}function f(){var t=e("#select_translate").val();return"none"===t?Promise.resolve(!0):"www"===t?(window.ADS.aliExtension.enableIframe(),window.ADS.aliExtension.getPage("https://www.aliexpress.com/?alidrop=set_global_site").then((function(e){window.ADS.aliExtension.enableAjax();var t=e.obj.find('script:contains("headerConfig")').text().match(/locale: "\w+_(\w+)",/im);return null!==t&&"US"===t[1].toUpperCase()}))):window.ADS.aliExtension.getPage("https://www.aliexpress.com").then((function(e){return window.ADS.aliExtension.getPage("https://"+t+".aliexpress.com").then((function(e){var i=e.obj.find('script:contains("headerConfig")').text().match(/locale: "\w+_(\w+)",/im);if(null===i)return!1;var r=i[1].toUpperCase();return function(e,t){e=e.toUpperCase(),t=t.toUpperCase();var i={WWW:"US",PT:"BR",RU:"RU",ES:"ES",FR:"FR",PL:"PL",HE:"IW",IT:"IT",TR:"TR",DE:"DE",KO:"KR",AR:"MA"};return void 0!==i[e]&&i[e]===t}(t,r)}))}))}return{init:function(){t=this,window.ADS.aliExtension.sleepTask(1),window.ADS.aliExtension.enableAjax(),r("review_form","",o),e(document).on("click","#js-reviewImport",(function(t){t.preventDefault(),e("#js-reviewNext").remove(),n=e(this),window.ADS.btnLock(n),e("#current_item").val(0),e("#ads_activities-list").html(""),window.ADS.progressText(e(".progress-head"),0,0),f().then((function(t){t?p(!0):(window.ADS.notify(e("#info-lan").text(),"danger"),window.ADS.btnUnLock(n))}))})),e(document).on("click","#js-reviewNext",(function(t){t.preventDefault(),e(this).remove(),n=e("#js-reviewImport"),e("#ads_activities-list").html("");var i=parseInt(e("#total_item").val()),r=parseInt(e("#current_item").val());r>0&&i>0&&window.ADS.progressText(e(".progress-head"),i,r),window.ADS.btnLock(n),f().then((function(t){t?p(!1):(window.ADS.notify(e("#info-lan").text(),"danger"),window.ADS.btnUnLock(n))}))})),e(document).on("request:done",(function(t){"#ads_review-form"===t.obj&&function(){if(e(document).find("#ignoreImages").is(":checked")){var t=e("#withImage"),i=t.parents(".checkbox-switchery"),r=e("#uploadImage"),n=r.parents(".checkbox-switchery");t.prop("checked")&&t.click(),r.prop("checked")&&r.click(),i.hide(),n.hide()}}()})),e(document).on("click","#ignoreImages",(function(){var t=e("#ads_review-form"),i=t.find("#withImage"),r=i.parents(".checkbox-switchery"),n=t.find("#uploadImage"),a=n.parents(".checkbox-switchery");e(this).is(":checked")?(i.prop("checked")&&i.click(),n.prop("checked")&&n.click(),r.hide(),a.hide()):(r.show(),a.show())})),e(document).on("change",'#ads_review-form [name="prod_type"]',(function(){e('#ads_review-form [name="applyto"]').val(""),a()})),e(document).on("change","#ads_review-form .js-select-cat",(function(){a()})),e(document).on("change",'#ads_review-form [name="apply_empty"]',(function(){a()})),e(document).on("change","#ads_review-form #apply_min",(function(){a()}))}}})().init()}))}});